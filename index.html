<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Tugas PAIB: Syu'abul Iman</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      line-height: 1.6;
      background: green;
    }
    .box {
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      background: white;
    }
    .btn {
      padding: 12px 24px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: not-allowed;
      transition: 0.3s;
    }
    .btn.active {
      cursor: pointer;
      background: green;
    }
    h2, h3 { color: #333; }
    iframe { border: black; }
  </style>
</head>
<body>
  <h2>Tugas PAIB: Syu'abul Iman</h2>

  <!-- Bagian membaca PDF dari Google Drive -->
  <div class="box">
    <h3>Bacalah Materi PDF Berikut (scroll dan baca sampai akhir, setelah membaca lanjutkan menonton video):</h3>
    <div id="pdfContainer" style="width:100%; height:800px; overflow-y:scroll; border:2px solid #ccc;">
      <!-- Ganti ID_GOOGLE_DRIVE dengan ID file PDF -->
      <iframe src="https://drive.google.com/file/d/1bg6p1kqUIQkAYH0HjvGAbE11RQDRoHfZ/preview" width="100%" height="800"></iframe>
    </div>
    <p id="readingStatus">Status: Belum selesai membaca ❌</p>
  </div>

  <!-- Bagian video YouTube -->
  <div class="box">
    <h3>Tonton Video Berikut:</h3>
    <iframe id="materiVideo"
      src="https://www.youtube.com/embed/aypspFSMIq8?enablejsapi=1&controls=0"
      width="100%" height="400"
      title="Video YouTube"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen></iframe>
    <p><i>Video tidak bisa di-skip, wajib ditonton sampai selesai, setelah selesai tekan tombol klik untuk selesai.</i></p>
  </div>

  <!-- Timer video -->
  <div class="box">
    <h3>Waktu Menonton Video</h3>
    <p id="videoTimer">Durasi: belum mulai</p>
  </div>

  <!-- Tombol selesai -->
  <button id="btnSelesai" class="btn" disabled>Selesai</button>

  <script>
    let readingDone = false;
    let videoDone = false;
    let videoDuration = 0;
    let player;
    let lastTime = 0;

    let btnSelesai = document.getElementById("btnSelesai");
    let readingStatus = document.getElementById("readingStatus");
    let videoTimerDisplay = document.getElementById("videoTimer");

    // Deteksi scroll container PDF
    const pdfContainer = document.getElementById("pdfContainer");
    pdfContainer.addEventListener("scroll", () => {
      if (pdfContainer.scrollTop + pdfContainer.clientHeight >= pdfContainer.scrollHeight - 5) {
        readingDone = true;
        readingStatus.textContent = "Status: Membaca selesai ✅";
        cekSelesai();
      }
    });

    function cekSelesai() {
      if (readingDone && videoDone) {
        btnSelesai.disabled = false;
        btnSelesai.classList.add("active");
        btnSelesai.textContent = "Klik untuk Selesai";
      }
    }

    // YouTube API
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('materiVideo', {
        events: {
          'onReady': function(event) {
            videoDuration = Math.floor(player.getDuration());
          },
          'onStateChange': function(event) {
            if (event.data == YT.PlayerState.PLAYING) {
              setInterval(() => {
                let currentTime = Math.floor(player.getCurrentTime());

                // deteksi skip
                if (currentTime - lastTime > 2) {
                  player.seekTo(lastTime);
                } else {
                  lastTime = currentTime;
                }

                let remaining = videoDuration - currentTime;
                let minutes = Math.floor(remaining / 60);
                let seconds = remaining % 60;
                videoTimerDisplay.textContent = `Sisa Durasi: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

                if (currentTime >= videoDuration - 1) {
                  videoDone = true;
                  videoTimerDisplay.textContent = "Video selesai ✅";
                  cekSelesai();
                }
              }, 1000);
            }
          }
        }
      });
    }

    // Load YouTube API
    let tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);

    // Redirect setelah selesai
    btnSelesai.addEventListener("click", function() {
      window.location.href = "https://forms.gle/VomZ9wwyKkfLqbVc6"; // ganti dengan link Google Form
    });
  </script>
</body>
</html>
